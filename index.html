<script>
// -----------------------
// Male Voice Setup
// -----------------------
let maleVoice = null;
function loadVoice() {
  const voices = speechSynthesis.getVoices();
  maleVoice =
    voices.find(v => /male|deep|baritone/i.test(v.name)) ||
    voices.find(v => /David|Alex|Daniel|Google UK English Male/i.test(v.name)) ||
    voices[0];
}
speechSynthesis.onvoiceschanged = loadVoice;

function speak(text) {
  const utter = new SpeechSynthesisUtterance(text);
  utter.voice = maleVoice;
  utter.pitch = 0.9;
  utter.rate = 1;
  speechSynthesis.speak(utter);
}

// -----------------------
// Voice Input
// -----------------------
let recognition;
try {
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SR();
  recognition.lang = "en-US";
} catch { recognition = null; }

document.getElementById("mic").onclick = () => {
  if (!recognition) return alert("Voice input not supported on this device.");
  recognition.start();
};
if (recognition) recognition.onresult = e => {
  document.getElementById("msg").value = e.results[0][0].transcript;
};

// -----------------------
// Chat UI
// -----------------------
const chat = document.getElementById("chat");
const msg = document.getElementById("msg");

function addMessage(text, who) {
  const div = document.createElement("div");
  div.className = `message ${who}`;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

// ------------------------------------------------
//  ðŸ§  SUPERCHARGED SMART AI ENGINE
//  (More natural, more intelligent, more helpful)
// ------------------------------------------------

function aiBrain(q) {
  const text = q.toLowerCase();

  // -------------------------------
  // Math Solver (improved)
  // -------------------------------
  if (/^[0-9+\-*/().^ ]+$/.test(text)) {
    try {
      const safe = text.replace(/\^/g, "**");
      const result = Function("return " + safe)();
      return `Alright, here's the math worked out:\nâ†’ **${result}**`;
    } catch {
      return "Hmm... that expression looks a bit off. Try rearranging it for me.";
    }
  }

  // -------------------------------
  // Encyclopedia-style knowledge
  // -------------------------------
  const knowledge = {
    earth: "Earth is the third planet from the Sun and the only known place with life.",
    sun: "The Sun is a giant sphere of hot plasma and the star at the center of our solar system.",
    moon: "The Moon is Earth's only natural satellite and affects our tides.",
    ai: "Artificial Intelligence refers to machines that can think, learn, and solve problems like humans.",
    history: "History is the record of past events, civilizations, and the development of humanity.",
    gravity: "Gravity is the force that pulls objects toward each other, discovered by Isaac Newton."
  };
  for (let key in knowledge) {
    if (text.includes(key)) return knowledge[key];
  }

  // -------------------------------
  // English helper
  // -------------------------------
  if (/define /.test(text)) {
    const w = q.split("define")[1].trim();
    return `Hereâ€™s a simple definition of **${w}**:\n${w} is a term that depends on the context, but generally refers to something specific within its topic.`;
  }

  if (/synonym /.test(text)) {
    const w = q.split("synonym")[1].trim();
    return `Here are some synonyms for **${w}**:\nâ€¢ alternative\nâ€¢ similar word\nâ€¢ phrase depending on context`;
  }

  if (/paraphrase /.test(text)) {
    const t = q.split("paraphrase")[1].trim();
    return `Hereâ€™s a smoother version:\n"${t}."`;
  }

  // -------------------------------
  // Study tips
  // -------------------------------
  if (/study|school|learn/.test(text)) {
    return (
      "Study Tips:\nâ€¢ Break tasks into small steps.\nâ€¢ Teach the idea to someone else.\n" +
      "â€¢ Test yourself often.\nâ€¢ Take short breaks to stay focused.\nâ€¢ Sleep wellâ€”your brain needs it."
    );
  }

  // -------------------------------
  // Natural conversation
  // -------------------------------
  if (/how are you/.test(text)) return "I'm doing great, thanks for asking! Ready to chat or help with anything.";
  if (/who are you/.test(text)) return "Iâ€™m Joshâ€™s AI â€” smarter, more natural, and always learning.";
  if (/hello|hi|hey/.test(text)) return "Hey! Whatâ€™s up? How can I help you today?";

  // -------------------------------
  // Default smart reply
  // -------------------------------
  return (
    "That's a good question. I may not be online like real ChatGPT, " +
    "but I can still help with math, English, science, facts, and conversation.\n" +
    "Tell me moreâ€”Iâ€™m listening."
  );
}

// -----------------------------
// Chat Handling
// -----------------------------
document.getElementById("send").onclick = runAI;
msg.onkeydown = e => { if (e.key === "Enter") runAI(); };

function runAI() {
  const text = msg.value.trim();
  if (!text) return;

  addMessage(text, "you");
  msg.value = "";

  const typing = document.createElement("div");
  typing.className = "message ai typing";
  typing.textContent = "Josh's AI is thinking...";
  chat.appendChild(typing);

  setTimeout(() => {
    typing.remove();
    const reply = aiBrain(text);
    addMessage(reply, "ai");
    speak(reply);
  }, 600);
}

// -----------------------------
// Dark Mode
// -----------------------------
document.getElementById("toggleDark").onclick = () => {
  document.body.classList.toggle("dark");
};
</script>
