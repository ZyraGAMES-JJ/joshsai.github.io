<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>CatGPT V2 (Online)</title>

<style>
body {
  margin: 0;
  background: #0d1117;
  color: white;
  font-family: Arial, sans-serif;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

#topbar {
  background: #161b22;
  padding: 10px 20px;
  display: flex;
  align-items: center;
  gap: 10px;
  border-bottom: 1px solid #30363d;
}

#logo {
  width: 34px;
  height: 34px;
  border-radius: 6px;
  background: linear-gradient(135deg, #3a7bff, #9a55ff);
}

#title {
  font-size: 20px;
  font-weight: bold;
}

#chat-container {
  flex: 1;
  display: flex;
  flex-direction: column;
  height: 100vh;
}

#chat {
  flex: 1;
  padding: 20px;
  overflow-y: auto;
}

.message {
  max-width: 75%;
  padding: 12px 16px;
  margin-bottom: 12px;
  border-radius: 10px;
}

.you {
  background: #238636;
  margin-left: auto;
}

.ai {
  background: #30363d;
  margin-right: auto;
  white-space: pre-wrap;
}

#input-area {
  display: flex;
  padding: 12px;
  background: #161b22;
  border-top: 1px solid #30363d;
  gap: 10px;
}

#msg {
  flex: 1;
  padding: 10px;
  border-radius: 6px;
  background: #0d1117;
  border: 1px solid #30363d;
  color: white;
}

#send {
  padding: 10px 16px;
  background: #3a7bff;
  border: none;
  color: white;
  border-radius: 6px;
  cursor: pointer;
}
</style>
</head>
<body>

<div id="topbar">
  <div id="logo"></div>
  <div id="title">CatGPT V2</div>
</div>

<div id="chat-container">
  <div id="chat"></div>

  <div id="input-area">
    <input id="msg" placeholder="Ask CatGPT anything...">
    <button id="send">Send</button>
  </div>
</div>

<script>
/* =====================================================
    ONLINE MODE — FETCH REAL ANSWERS
===================================================== */

async function onlineKnowledge(query) {
  const encoded = encodeURIComponent(query);

  // Using AllOrigins to bypass CORS for GitHub Pages
  const url = `https://api.allorigins.win/raw?url=https://en.wikipedia.org/api/rest_v1/page/summary/${encoded}`;

  try {
    const res = await fetch(url);
    if (!res.ok) return null;

    const data = await res.json();
    if (data.extract) return data.extract;

    return null;
  } catch {
    return null;
  }
}


/* ---------- Math Solver ---------- */
function solveMath(input) {
  let q = input.toLowerCase();
  q = q.replace(/multiplied by|times|x/g, "*");
  q = q.replace(/plus/g, "+");
  q = q.replace(/minus/g, "-");
  q = q.replace(/divided by|over/g, "/");

  const match = q.match(/[0-9\.\s\+\-\*\/\(\)]+/g);
  if (!match) return null;

  try {
    let result = eval(match[0]);
    if (!isNaN(result)) return result;
  } catch {}

  return null;
}


/* ---------- Main Brain ---------- */
async function UltraBrain(input) {
  let lower = input.toLowerCase();

  // Math
  const math = solveMath(input);
  if (math !== null) return `The answer is: ${math}`;

  // Online Knowledge (Wikipedia)
  const wiki = await onlineKnowledge(input);
  if (wiki) return wiki;

  return `I don't fully know, but here's what I understand from your question: ${input}`;
}


/* ---------- Typing Animation ---------- */
function typeMessage(div, text, speed = 20) {
  let i = 0;
  function t() {
    if (i < text.length) {
      div.textContent += text.charAt(i);
      i++;
      setTimeout(t, speed);
    }
  }
  t();
}


/* =====================================================
    CHAT SYSTEM
===================================================== */

const chat = document.getElementById("chat");
const msg = document.getElementById("msg");

function addUserMessage(text) {
  const div = document.createElement("div");
  div.className = "message you";
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function addAIMessage(text) {
  const div = document.createElement("div");
  div.className = "message ai";
  chat.appendChild(div);
  typeMessage(div, text);
  chat.scrollTop = chat.scrollHeight;
}

async function runAI() {
  const text = msg.value.trim();
  if (!text) return;
  msg.value = "";

  addUserMessage(text);

  const reply = await UltraBrain(text);
  addAIMessage(reply);
}

document.getElementById("send").onclick = runAI;
msg.onkeydown = e => (e.key === "Enter" ? runAI() : null);

/* ---------- Welcome message ---------- */
addAIMessage("Welcome! I am CatGPT V2 — now connected online. Ask me anything!");
</script>

</body>
</html>
